#!/bin/bash

CONFIGS=(
  "CONFIG_NET_ACT_CT=m"
  "CONFIG_NET_ACT_CTINFO=m"
  "CONFIG_ARM_SCMI_TRANSPORT_VIRTIO=y"
  "CONFIG_ARM_SCMI_TRANSPORT_VIRTIO_VERSION1_COMPLIANCE=y"
  "CONFIG_ARM_SCMI_TRANSPORT_VIRTIO_ATOMIC_ENABLE=y"
  "CONFIG_KVM=y"
  "CONFIG_NVHE_EL2_DEBUG=n"
  "CONFIG_PROTECTED_NVHE_STACKTRACE=n"
  "CONFIG_VIRTIO_MENU=y"
  "CONFIG_VIRTUALIZATION=y"
  "CONFIG_VFIO_AMBA=y"
  "CONFIG_KVM_ARM_HOST=y"
  "CONFIG_KVM_ARM_VGIC=y"
  "CONFIG_KVM_ARM_TIMER=y"
  "CONFIG_VIRTIO_NET=y"
  "CONFIG_VIRTIO_BLK=y"
  "CONFIG_VIRTIO_CONSOLE=y"
  "CONFIG_VIRTIO_MMIO=y"
  "CONFIG_VHOST_NET=y"
  "CONFIG_VHOST_VSOCK=y"
  "CONFIG_VHOST_SCSI=y"
  "CONFIG_TUN=y"
  "CONFIG_BRIDGE=y"
  "CONFIG_BRIDGE_VLAN_FILTERING=y"
  "CONFIG_IOMMU_SUPPORT=y"
  "CONFIG_ARM_SMMU=y"
  "CONFIG_ROCKCHIP_IOMMU=y"
  "CONFIG_VFIO=y"
  "CONFIG_VFIO_IOMMU_TYPE1=y"
  "CONFIG_VFIO_PLATFORM=y"
  "CONFIG_USB_UAS=n"
  "CONFIG_DRM=y"
  "CONFIG_DRM_KMS_HELPER=y"
  "CONFIG_DRM_GEM_SHMEM_HELPER=y"
  "CONFIG_DRM_ROCKCHIP=y"
  "CONFIG_VIDEO_DEV=y"
  "CONFIG_MEDIA_SUPPORT=y"
  "CONFIG_MEDIA_CONTROLLER=y"
  "CONFIG_MEDIA_CONTROLLER_REQUEST_API=y"
  "CONFIG_VIDEO_V4L2=y"
  "CONFIG_VIDEO_V4L2_SUBDEV_API=y"
  "CONFIG_VIDEO_V4L2_TPG=y"
  "CONFIG_VIDEO_V4L2_MMEM2MEM=y"
  "CONFIG_V4L2_MEM2MEM_DEV=y"
  "CONFIG_VIDEO_V4L2_REQUEST=y"
  "CONFIG_VIDEO_HANTRO=y"
  "CONFIG_VIDEO_HANTRO_ROCKCHIP=y"
  "CONFIG_VIDEO_ROCKCHIP_VDEC=y"
  "CONFIG_VIDEO_ROCKCHIP_VPU=y"
  "CONFIG_VIDEO_ROCKCHIP_RGA=y"
  "CONFIG_DRM_PANFROST=y"
  "CONFIG_FW_LOADER=y"
	"CONFIG_FW_LOADER_USER_HELPER=y"
	"CONFIG_DEVTMPFS=y"
	"CONFIG_DEVTMPFS_MOUNT=y"
  "CONFIG_VFIO_NOIOMMU=y"
  "CONFIG_VFIO_PCI=y"
  "CONFIG_DRM_RENDER_SUPPORT=y"
  "CONFIG_DRM_DRI_MODULE=y"
  "CONFIG_DEV_COREDUMP=y"
  "CONFIG_ARM_DMA_USE_IOMMU=y"
)

source .current_config.mk
KCFG=kernel/arch/arm64/configs/$(awk '{print $1}' <<< "$TARGET_KERNEL_CONFIG")

for CFG in "${CONFIGS[@]}"; do
  KEY=${CFG%%=*}
  if grep -q "^#\?${KEY}=" "${KCFG}"; then
    sed -i "s@^#\?${KEY}=.*@${CFG}@g" "${KCFG}"
  else
    echo "$CFG" >> "${KCFG}"
  fi
done
